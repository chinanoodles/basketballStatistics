# 临时允许外网访问前端

## 快速步骤

### 1. 确保前端使用 `--host` 参数启动

如果前端还没有使用 `--host` 参数，需要重启：

```bash
# 停止当前前端（在运行前端的终端按 Ctrl+C）
# 然后重新启动
cd frontend
npm run dev:host
```

### 2. 配置防火墙（macOS）

```bash
# 允许 3000 端口（前端）
sudo /usr/libexec/ApplicationFirewall/socketfilterfw --add /usr/local/bin/node
sudo /usr/libexec/ApplicationFirewall/socketfilterfw --unblockapp /usr/local/bin/node

# 或者直接允许端口
sudo pfctl -f /etc/pf.conf  # 如果使用 pf 防火墙
```

或者通过系统设置：
1. 系统偏好设置 > 安全性与隐私 > 防火墙
2. 点击"防火墙选项"
3. 确保 Node.js 或相关应用允许传入连接

### 3. 访问地址

- **本地访问**：`http://localhost:3000`
- **局域网访问**：`http://192.168.31.38:3000`
- **外网访问**：`http://114.246.0.79:3000`（需要配置路由器端口转发）

### 4. 配置路由器端口转发（外网访问必需）

如果要从外网访问，需要配置路由器端口转发：

1. 登录路由器管理界面（通常是 `192.168.1.1` 或 `192.168.0.1`）
2. 找到"端口转发"或"虚拟服务器"设置
3. 添加规则：
   - **前端（3000端口）**：
     - 外部端口：3000
     - 内部IP：192.168.31.38
     - 内部端口：3000
     - 协议：TCP
   - **后端（8000端口）**（如果也需要外网访问）：
     - 外部端口：8000
     - 内部IP：192.168.31.38
     - 内部端口：8000
     - 协议：TCP

### 5. 配置前端 API 地址（如果后端也在外网）

如果前端需要从外网访问后端，需要配置前端的 API 地址：

```bash
cd frontend
# 创建或编辑 .env 文件
echo "VITE_API_URL=http://114.246.0.79:8000/api/v1" > .env
# 或者如果后端在同一台机器，使用相对路径（通过 Vite proxy）
# echo "VITE_BACKEND_URL=http://114.246.0.79:8000" > .env
```

然后重启前端服务器。

## 验证

### 1. 检查前端是否监听所有接口

```bash
lsof -i :3000
# 应该看到类似：*:3000 (LISTEN) 或 0.0.0.0:3000 (LISTEN)
```

### 2. 测试本地访问

```bash
curl http://localhost:3000
```

### 3. 测试局域网访问

在同一网络的其他设备上：
```bash
curl http://192.168.31.38:3000
```

### 4. 测试外网访问

在外网设备上：
```bash
curl http://114.246.0.79:3000
```

## 注意事项

⚠️ **安全警告**：
- 临时开放外网访问存在安全风险
- 建议使用完成后关闭外网访问
- 生产环境建议使用 HTTPS 和身份验证

## 快速命令

### 启动前端（允许外网）
```bash
cd frontend
npm run dev:host
```

### 启动后端（允许外网）
```bash
./start_backend.sh --external
```

### 检查端口监听
```bash
# 检查前端
lsof -i :3000

# 检查后端
lsof -i :8000
```

