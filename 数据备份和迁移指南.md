# æ•°æ®å¤‡ä»½å’Œè¿ç§»æŒ‡å—

## ğŸ“ æ•°æ®å­˜å‚¨ä½ç½®

### å½“å‰æ•°æ®å­˜å‚¨
- **æ•°æ®åº“æ–‡ä»¶**ï¼š`backend/database/basketball.db`
- **æ•°æ®åº“ç±»å‹**ï¼šSQLiteï¼ˆå•æ–‡ä»¶æ•°æ®åº“ï¼‰
- **åŒ…å«æ•°æ®**ï¼šæ‰€æœ‰çƒé˜Ÿã€çƒå‘˜ã€æ¯”èµ›è®°å½•ã€ç»Ÿè®¡æ•°æ®

### é‡è¦è¯´æ˜
âš ï¸ **SQLite æ•°æ®åº“æ–‡ä»¶é»˜è®¤åœ¨ `.gitignore` ä¸­ï¼Œä¸ä¼šè¢«ä¸Šä¼ åˆ° Gitï¼**

è¿™æ„å‘³ç€ï¼š
- âœ… ä»£ç ä¼šä¸Šä¼ åˆ° Git
- âŒ **æ•°æ®åº“æ–‡ä»¶ä¸ä¼šä¸Šä¼ åˆ° Git**
- âš ï¸ éƒ¨ç½²åˆ°æ–°æœåŠ¡å™¨æ—¶ï¼Œæ•°æ®åº“æ˜¯ç©ºçš„ï¼Œéœ€è¦é‡æ–°åˆ›å»ºæˆ–è¿ç§»æ•°æ®

## ğŸ”„ æ•°æ®è¿ç§»æ–¹æ¡ˆ

### æ–¹æ¡ˆä¸€ï¼šæ‰‹åŠ¨å¤‡ä»½å’Œæ¢å¤ï¼ˆæ¨èï¼‰

#### 1. æœ¬åœ°å¤‡ä»½æ•°æ®åº“
```bash
# åœ¨æœ¬åœ°é¡¹ç›®ç›®å½•
cd backend/database
cp basketball.db basketball.db.backup

# æˆ–è€…ä½¿ç”¨æ—¶é—´æˆ³å‘½å
cp basketball.db basketball.db.$(date +%Y%m%d_%H%M%S).backup
```

#### 2. ä¸Šä¼ åˆ°æœåŠ¡å™¨
```bash
# ä½¿ç”¨ scp ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp backend/database/basketball.db user@your-server-ip:/path/to/backend/database/

# æˆ–è€…ä½¿ç”¨ rsync
rsync -avz backend/database/basketball.db user@your-server-ip:/path/to/backend/database/
```

#### 3. åœ¨æœåŠ¡å™¨ä¸Šæ¢å¤
```bash
# SSH ç™»å½•æœåŠ¡å™¨
ssh user@your-server-ip

# è¿›å…¥é¡¹ç›®ç›®å½•
cd /path/to/basketballStatistics/backend/database

# ç¡®ä¿æ•°æ®åº“æ–‡ä»¶å­˜åœ¨ä¸”æƒé™æ­£ç¡®
chmod 644 basketball.db
chown your-user:your-user basketball.db
```

### æ–¹æ¡ˆäºŒï¼šä½¿ç”¨ Git LFSï¼ˆå¤§æ–‡ä»¶å­˜å‚¨ï¼‰

å¦‚æœæ•°æ®åº“æ–‡ä»¶è¾ƒå¤§ï¼Œå¯ä»¥ä½¿ç”¨ Git LFSï¼š

#### 1. å®‰è£… Git LFS
```bash
# macOS
brew install git-lfs

# åˆå§‹åŒ–
git lfs install
```

#### 2. é…ç½® Git LFS è·Ÿè¸ªæ•°æ®åº“æ–‡ä»¶
```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
git lfs track "backend/database/*.db"
git add .gitattributes
git add backend/database/basketball.db
git commit -m "Add database file with Git LFS"
git push
```

âš ï¸ **æ³¨æ„**ï¼šGit LFS æœ‰å­˜å‚¨é™åˆ¶ï¼Œå…è´¹ç‰ˆé€šå¸¸æœ‰æµé‡é™åˆ¶ã€‚

### æ–¹æ¡ˆä¸‰ï¼šå®šæœŸå¤‡ä»½è„šæœ¬ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰

åˆ›å»ºè‡ªåŠ¨å¤‡ä»½è„šæœ¬ï¼š

#### 1. åˆ›å»ºå¤‡ä»½è„šæœ¬
```bash
# åˆ›å»º backup_db.sh
cat > backup_db.sh << 'EOF'
#!/bin/bash
# æ•°æ®åº“å¤‡ä»½è„šæœ¬

BACKUP_DIR="./backups"
DB_FILE="backend/database/basketball.db"
TIMESTAMP=$(date +%Y%m%d_%H%M%S)
BACKUP_FILE="${BACKUP_DIR}/basketball_${TIMESTAMP}.db"

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p ${BACKUP_DIR}

# å¤‡ä»½æ•°æ®åº“
if [ -f "${DB_FILE}" ]; then
    cp "${DB_FILE}" "${BACKUP_FILE}"
    echo "âœ… å¤‡ä»½æˆåŠŸ: ${BACKUP_FILE}"
    
    # å‹ç¼©å¤‡ä»½ï¼ˆå¯é€‰ï¼‰
    gzip "${BACKUP_FILE}"
    echo "âœ… å‹ç¼©å®Œæˆ: ${BACKUP_FILE}.gz"
    
    # åˆ é™¤7å¤©å‰çš„å¤‡ä»½ï¼ˆå¯é€‰ï¼‰
    find ${BACKUP_DIR} -name "basketball_*.db.gz" -mtime +7 -delete
else
    echo "âŒ æ•°æ®åº“æ–‡ä»¶ä¸å­˜åœ¨: ${DB_FILE}"
    exit 1
fi
EOF

chmod +x backup_db.sh
```

#### 2. æ·»åŠ åˆ° .gitignoreï¼ˆå¤‡ä»½ç›®å½•ï¼‰
```bash
# åœ¨ .gitignore ä¸­æ·»åŠ 
echo "backups/" >> .gitignore
```

#### 3. å®šæœŸæ‰§è¡Œå¤‡ä»½
```bash
# æ‰‹åŠ¨æ‰§è¡Œ
./backup_db.sh

# æˆ–æ·»åŠ åˆ° crontabï¼ˆæ¯å¤©å‡Œæ™¨2ç‚¹å¤‡ä»½ï¼‰
# crontab -e
# 0 2 * * * /path/to/backup_db.sh
```

## ğŸš€ éƒ¨ç½²åˆ°é˜¿é‡Œäº‘æ—¶çš„æ•°æ®è¿ç§»

### æ­¥éª¤1ï¼šæœ¬åœ°å¤‡ä»½
```bash
# åœ¨æœ¬åœ°é¡¹ç›®ç›®å½•
cd /Users/fanzhang/Documents/toolDev/basketballStatistics

# åˆ›å»ºå¤‡ä»½
mkdir -p backups
cp backend/database/basketball.db backups/basketball_$(date +%Y%m%d).db
```

### æ­¥éª¤2ï¼šéƒ¨ç½²ä»£ç åˆ°æœåŠ¡å™¨
```bash
# åœ¨æœåŠ¡å™¨ä¸Š
git clone <your-repo-url>
cd basketballStatistics

# å®‰è£…ä¾èµ–
# ... (æŒ‰ç…§éƒ¨ç½²æ–‡æ¡£)
```

### æ­¥éª¤3ï¼šä¸Šä¼ æ•°æ®åº“æ–‡ä»¶
```bash
# ä»æœ¬åœ°ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp backups/basketball_*.db user@your-server-ip:/path/to/basketballStatistics/backend/database/basketball.db
```

### æ­¥éª¤4ï¼šè®¾ç½®æƒé™
```bash
# åœ¨æœåŠ¡å™¨ä¸Š
cd /path/to/basketballStatistics/backend/database
chmod 644 basketball.db
chown your-user:your-user basketball.db
```

### æ­¥éª¤5ï¼šéªŒè¯æ•°æ®
```bash
# åœ¨æœåŠ¡å™¨ä¸Šï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªéªŒè¯è„šæœ¬
python3 -c "
from app.database.base import get_db
from app.models.game import Game
db = next(get_db())
games = db.query(Game).count()
print(f'æ¯”èµ›è®°å½•æ•°: {games}')
"
```

## ğŸ“¦ æ•°æ®å¯¼å‡ºå’Œå¯¼å…¥

### å¯¼å‡ºæ•°æ®ä¸º SQL
```bash
# ä½¿ç”¨ sqlite3 å¯¼å‡º
sqlite3 backend/database/basketball.db .dump > basketball_backup.sql
```

### å¯¼å…¥ SQL æ•°æ®
```bash
# åœ¨æœåŠ¡å™¨ä¸Š
sqlite3 backend/database/basketball.db < basketball_backup.sql
```

### å¯¼å‡ºä¸º CSVï¼ˆéƒ¨åˆ†æ•°æ®ï¼‰
```python
# å¯ä»¥åˆ›å»ºå¯¼å‡ºè„šæœ¬
# export_data.py
import csv
from app.database.base import get_db
from app.models.game import Game

db = next(get_db())
games = db.query(Game).all()

with open('games_export.csv', 'w', newline='') as f:
    writer = csv.writer(f)
    writer.writerow(['id', 'home_team_id', 'away_team_id', 'date', 'status'])
    for game in games:
        writer.writerow([game.id, game.home_team_id, game.away_team_id, game.date, game.status])
```

## ğŸ” å®‰å…¨å»ºè®®

### 1. æ•°æ®åº“æ–‡ä»¶æƒé™
```bash
# è®¾ç½®åˆé€‚çš„æƒé™ï¼ˆåªæœ‰æ‰€æœ‰è€…å¯è¯»å†™ï¼‰
chmod 600 backend/database/basketball.db
```

### 2. å¤‡ä»½æ–‡ä»¶åŠ å¯†ï¼ˆå¯é€‰ï¼‰
```bash
# ä½¿ç”¨ openssl åŠ å¯†å¤‡ä»½
openssl enc -aes-256-cbc -salt -in basketball.db -out basketball.db.enc

# è§£å¯†
openssl enc -aes-256-cbc -d -in basketball.db.enc -out basketball.db
```

### 3. å®šæœŸå¤‡ä»½åˆ°äº‘å­˜å‚¨
```bash
# å¤‡ä»½åˆ°é˜¿é‡Œäº‘ OSSï¼ˆç¤ºä¾‹ï¼‰
ossutil cp backups/basketball_*.db oss://your-bucket/backups/
```

## ğŸ“‹ éƒ¨ç½²æ£€æŸ¥æ¸…å•

åœ¨éƒ¨ç½²åˆ°é˜¿é‡Œäº‘ä¹‹å‰ï¼š

- [ ] æœ¬åœ°å¤‡ä»½æ•°æ®åº“æ–‡ä»¶
- [ ] ç¡®è®¤ `.gitignore` åŒ…å« `*.db` å’Œ `database/`
- [ ] å‡†å¤‡æ•°æ®åº“è¿ç§»æ–¹æ¡ˆ
- [ ] æµ‹è¯•æ•°æ®åº“æ¢å¤æµç¨‹
- [ ] é…ç½®æœåŠ¡å™¨ä¸Šçš„å¤‡ä»½è„šæœ¬
- [ ] è®¾ç½®æ•°æ®åº“æ–‡ä»¶æƒé™
- [ ] éªŒè¯æ•°æ®å®Œæ•´æ€§

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆä¸Šä¼ åˆ° Git åæ•°æ®æ²¡äº†ï¼Ÿ
A: å› ä¸ºæ•°æ®åº“æ–‡ä»¶åœ¨ `.gitignore` ä¸­ï¼Œä¸ä¼šè¢« Git è·Ÿè¸ªã€‚è¿™æ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºï¼š
- æ•°æ®åº“æ–‡ä»¶é€šå¸¸å¾ˆå¤§
- åŒ…å«æ•æ„Ÿæ•°æ®
- ä¸åº”è¯¥åœ¨ç‰ˆæœ¬æ§åˆ¶ä¸­

### Q: å¦‚ä½•ç¡®ä¿æ•°æ®ä¸ä¸¢å¤±ï¼Ÿ
A: 
1. å®šæœŸå¤‡ä»½æ•°æ®åº“æ–‡ä»¶
2. ä½¿ç”¨å¤‡ä»½è„šæœ¬è‡ªåŠ¨åŒ–
3. å°†å¤‡ä»½ä¸Šä¼ åˆ°äº‘å­˜å‚¨
4. éƒ¨ç½²å‰å…ˆå¤‡ä»½

### Q: å¯ä»¥åœ¨ Git ä¸­ä¿å­˜æ•°æ®åº“å—ï¼Ÿ
A: å¯ä»¥ï¼Œä½†ä¸æ¨èï¼š
- ä½¿ç”¨ Git LFSï¼ˆæœ‰æµé‡é™åˆ¶ï¼‰
- åªé€‚åˆå°æ•°æ®åº“
- ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ä¸“é—¨çš„å¤‡ä»½æ–¹æ¡ˆ

### Q: éƒ¨ç½²åå¦‚ä½•æ¢å¤æ•°æ®ï¼Ÿ
A:
1. ä»å¤‡ä»½æ¢å¤æ•°æ®åº“æ–‡ä»¶
2. æˆ–ä½¿ç”¨æ•°æ®å¯¼å‡º/å¯¼å…¥è„šæœ¬
3. æˆ–é‡æ–°å¯¼å…¥ CSV æ•°æ®

## ğŸ“ å¿«é€Ÿå‘½ä»¤å‚è€ƒ

```bash
# å¤‡ä»½æ•°æ®åº“
cp backend/database/basketball.db backups/basketball_$(date +%Y%m%d).db

# ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp backend/database/basketball.db user@server:/path/to/backend/database/

# å¯¼å‡ºä¸º SQL
sqlite3 backend/database/basketball.db .dump > backup.sql

# å¯¼å…¥ SQL
sqlite3 backend/database/basketball.db < backup.sql

# æ£€æŸ¥æ•°æ®åº“å¤§å°
ls -lh backend/database/basketball.db

# æ£€æŸ¥æ•°æ®åº“è®°å½•æ•°
sqlite3 backend/database/basketball.db "SELECT COUNT(*) FROM games;"
```


