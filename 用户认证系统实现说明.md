# ç”¨æˆ·è®¤è¯å’ŒLeagueç®¡ç†ç³»ç»Ÿ - å®ç°è¯´æ˜

## âœ… å·²å®Œæˆéƒ¨åˆ†

### 1. åç«¯æ•°æ®æ¨¡å‹
- âœ… **Useræ¨¡å‹** (`backend/app/models/user.py`)
  - ç”¨æˆ·åã€é‚®ç®±ã€å¯†ç 
  - è§’è‰²ï¼šPLAYERï¼ˆçƒå‘˜ï¼‰ã€TEAM_ADMINï¼ˆçƒé˜Ÿç®¡ç†å‘˜ï¼‰ã€ADMINï¼ˆç³»ç»Ÿç®¡ç†å‘˜ï¼‰
  - å…³è”åˆ°League
  
- âœ… **Leagueæ¨¡å‹** (`backend/app/models/league.py`)
  - è”èµ›åç§°ã€æè¿°
  - å¯è‡ªå®šä¹‰ï¼šå°ç»„èµ›/å¸¸è§„èµ›åç§°ã€å­£åèµ›/æ·˜æ±°èµ›åç§°
  - æ”¯æŒæ¿€æ´»/ç¦ç”¨

- âœ… **ä¿®æ”¹ç°æœ‰æ¨¡å‹**
  - Teamæ¨¡å‹ï¼šæ·»åŠ  `league_id` å¤–é”®
  - Gameæ¨¡å‹ï¼šæ·»åŠ  `league_id` å’Œ `season_type`ï¼ˆREGULAR/PLAYOFFï¼‰

### 2. è®¤è¯ç³»ç»Ÿ
- âœ… **JWTè®¤è¯** (`backend/app/core/security.py`)
  - å¯†ç åŠ å¯†ï¼ˆbcryptï¼‰
  - JWTä»¤ç‰Œç”Ÿæˆå’ŒéªŒè¯
  - 7å¤©æœ‰æ•ˆæœŸ

- âœ… **ä¾èµ–æ³¨å…¥** (`backend/app/core/dependencies.py`)
  - `get_current_user`: è·å–å½“å‰ç™»å½•ç”¨æˆ·
  - `get_current_active_user`: è·å–æ´»è·ƒç”¨æˆ·
  - `get_current_admin`: è·å–ç³»ç»Ÿç®¡ç†å‘˜ï¼ˆæƒé™æ£€æŸ¥ï¼‰
  - `get_current_team_admin`: è·å–çƒé˜Ÿç®¡ç†å‘˜æˆ–ç³»ç»Ÿç®¡ç†å‘˜ï¼ˆæƒé™æ£€æŸ¥ï¼‰

### 3. APIè·¯ç”±
- âœ… **è®¤è¯API** (`backend/app/api/auth.py`)
  - `POST /api/v1/auth/register` - ç”¨æˆ·æ³¨å†Œï¼ˆæ”¯æŒé€‰æ‹©è§’è‰²å’Œè”èµ›ï¼‰
  - `POST /api/v1/auth/login` - ç”¨æˆ·ç™»å½•
  - `GET /api/v1/auth/me` - è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯

- âœ… **Leagueç®¡ç†API** (`backend/app/api/leagues.py`)
  - `GET /api/v1/leagues/public` - è·å–å…¬å¼€è”èµ›åˆ—è¡¨ï¼ˆæ³¨å†Œæ—¶ä½¿ç”¨ï¼Œä¸éœ€è¦è®¤è¯ï¼‰
  - `POST /api/v1/leagues` - åˆ›å»ºè”èµ›ï¼ˆä»…ç³»ç»Ÿç®¡ç†å‘˜ï¼‰
  - `GET /api/v1/leagues` - è·å–è”èµ›åˆ—è¡¨
  - `GET /api/v1/leagues/{id}` - è·å–è”èµ›è¯¦æƒ…
  - `PUT /api/v1/leagues/{id}` - æ›´æ–°è”èµ›ï¼ˆä»…ç³»ç»Ÿç®¡ç†å‘˜ï¼‰
  - `DELETE /api/v1/leagues/{id}` - åˆ é™¤è”èµ›ï¼ˆä»…ç³»ç»Ÿç®¡ç†å‘˜ï¼‰

- âœ… **Teams API** (`backend/app/api/teams.py`)
  - æ‰€æœ‰æ¥å£å·²æ·»åŠ Leagueè¿‡æ»¤å’Œæƒé™æ£€æŸ¥
  - çƒå‘˜åªèƒ½æŸ¥çœ‹ï¼Œçƒé˜Ÿç®¡ç†å‘˜å¯ä»¥åˆ›å»º/ä¿®æ”¹/åˆ é™¤

- âœ… **Players API** (`backend/app/api/players.py`)
  - æ‰€æœ‰æ¥å£å·²æ·»åŠ Leagueè¿‡æ»¤å’Œæƒé™æ£€æŸ¥
  - çƒå‘˜åªèƒ½æŸ¥çœ‹ï¼Œçƒé˜Ÿç®¡ç†å‘˜å¯ä»¥åˆ›å»º/ä¿®æ”¹/åˆ é™¤

- âœ… **Games API** (`backend/app/api/games.py`)
  - æ‰€æœ‰æ¥å£å·²æ·»åŠ Leagueè¿‡æ»¤å’Œseason_typeæ”¯æŒ
  - çƒå‘˜åªèƒ½æŸ¥çœ‹ï¼Œçƒé˜Ÿç®¡ç†å‘˜å¯ä»¥åˆ›å»º/æ“ä½œæ¯”èµ›

- âœ… **Statistics API** (`backend/app/api/statistics.py`)
  - å·²æ·»åŠ Leagueè¿‡æ»¤å’Œseason_typeç­›é€‰
  - æ–°å¢ `GET /api/v1/statistics/league/{league_id}` æ¥å£

- âœ… **PlayerTime API** (`backend/app/api/player_time.py`)
  - å·²æ·»åŠ Leagueè¿‡æ»¤å’Œæƒé™æ£€æŸ¥

### 4. æ•°æ®åº“è¿ç§»
- âœ… **è¿ç§»è„šæœ¬** (`backend/migrate_add_user_league.py`)
  - åˆ›å»ºuserså’Œleaguesè¡¨
  - åˆ›å»ºé»˜è®¤è”èµ›
  - åˆ›å»ºé»˜è®¤ç®¡ç†å‘˜ç”¨æˆ·ï¼ˆadmin/admin123ï¼‰

- âœ… **è¿ç§»è„šæœ¬** (`backend/migrate_add_league_id.py`)
  - ä¸ºteamså’Œgamesè¡¨æ·»åŠ league_idå’Œseason_typeåˆ—
  - ä¸ºç°æœ‰æ•°æ®åˆ†é…é»˜è®¤league_id

- âœ… **è¿ç§»è„šæœ¬** (`backend/migrate_update_user_roles.py`)
  - æ›´æ–°ç”¨æˆ·è§’è‰²ç³»ç»Ÿ
  - å°†æ—§çš„'user'è§’è‰²æ›´æ–°ä¸º'player'
  - å°†å°å†™çš„'admin'æ›´æ–°ä¸ºå¤§å†™çš„'ADMIN'

### 5. å‰ç«¯å®ç°
- âœ… **ç™»å½•é¡µé¢** (`frontend/src/pages/Login.tsx`)
  - ç™»å½•è¡¨å•
  - æ³¨å†Œè¡¨å•ï¼ˆæ”¯æŒé€‰æ‹©è§’è‰²å’Œè”èµ›ï¼‰
  - ä½¿ç”¨å…¬å¼€APIåŠ è½½è”èµ›åˆ—è¡¨
  - Tokenå­˜å‚¨ï¼ˆlocalStorageï¼‰
  
- âœ… **è®¤è¯ä¸Šä¸‹æ–‡** (`frontend/src/contexts/AuthContext.tsx`)
  - ç”¨æˆ·çŠ¶æ€ç®¡ç†
  - Tokenç®¡ç†
  - è‡ªåŠ¨ç™»å½•éªŒè¯
  - è§’è‰²æƒé™æ£€æŸ¥ï¼ˆisAdmin, isTeamAdmin, isPlayerï¼‰

- âœ… **è·¯ç”±ä¿æŠ¤** (`frontend/src/components/ProtectedRoute.tsx`)
  - æœªç™»å½•é‡å®šå‘åˆ°ç™»å½•é¡µ
  - æƒé™æ£€æŸ¥ï¼ˆæ”¯æŒrequireAdminï¼‰

- âœ… **Homeé¡µé¢** (`frontend/src/pages/Home.tsx`)
  - æ ¹æ®è§’è‰²æ˜¾ç¤ºä¸åŒèœå•
  - çƒå‘˜ï¼šåªèƒ½çœ‹åˆ°æ¯”èµ›è®°å½•å’ŒæŠ€æœ¯ç»Ÿè®¡
  - çƒé˜Ÿç®¡ç†å‘˜ï¼šå¯ä»¥çœ‹åˆ°çƒé˜Ÿç®¡ç†ã€å¼€å§‹æ–°æ¯”èµ›ç­‰
  - ç³»ç»Ÿç®¡ç†å‘˜ï¼šå¯ä»¥çœ‹åˆ°æ‰€æœ‰åŠŸèƒ½åŒ…æ‹¬è”èµ›ç®¡ç†

- âœ… **Leagueç®¡ç†é¡µé¢** (`frontend/src/pages/LeagueManagement.tsx`)
  - åˆ›å»º/ç¼–è¾‘Leagueï¼ˆç³»ç»Ÿç®¡ç†å‘˜ï¼‰
  - è®¾ç½®å°ç»„èµ›/å­£åèµ›åç§°
  - Leagueåˆ—è¡¨

- âœ… **ç»Ÿè®¡é¡µé¢** (`frontend/src/pages/Statistics.tsx`)
  - æ·»åŠ season_typeç­›é€‰ï¼ˆå°ç»„èµ›/å­£åèµ›/å…¨éƒ¨ï¼‰
  - æ ¹æ®Leagueè¿‡æ»¤æ•°æ®

- âœ… **GameSetupé¡µé¢** (`frontend/src/pages/GameSetup.tsx`)
  - æ·»åŠ season_typeé€‰æ‹©

## ğŸ­ ç”¨æˆ·è§’è‰²å’Œæƒé™

### çƒå‘˜ï¼ˆPLAYERï¼‰
**æƒé™èŒƒå›´ï¼š**
- âœ… å¯ä»¥æŸ¥çœ‹ï¼šæ¯”èµ›è®°å½•ã€æŠ€æœ¯ç»Ÿè®¡
- âŒ ä¸èƒ½æ“ä½œï¼šåˆ›å»º/ä¿®æ”¹/åˆ é™¤çƒé˜Ÿã€çƒå‘˜ã€æ¯”èµ›

**å¯è§èœå•ï¼š**
- æ¯”èµ›è®°å½•
- æŠ€æœ¯ç»Ÿè®¡

### çƒé˜Ÿç®¡ç†å‘˜ï¼ˆTEAM_ADMINï¼‰
**æƒé™èŒƒå›´ï¼š**
- âœ… å¯ä»¥æŸ¥çœ‹ï¼šæ¯”èµ›è®°å½•ã€æŠ€æœ¯ç»Ÿè®¡
- âœ… å¯ä»¥ç®¡ç†ï¼šè‡ªå·±è”èµ›çš„çƒé˜Ÿå’Œçƒå‘˜
- âœ… å¯ä»¥åˆ›å»ºï¼šè‡ªå·±è”èµ›çš„æ¯”èµ›
- âŒ ä¸èƒ½ç®¡ç†ï¼šå…¶ä»–è”èµ›çš„æ•°æ®ã€è”èµ›è®¾ç½®

**å¯è§èœå•ï¼š**
- å¼€å§‹æ–°æ¯”èµ›
- çƒé˜Ÿç®¡ç†
- æ¯”èµ›è®°å½•
- æŠ€æœ¯ç»Ÿè®¡

### ç³»ç»Ÿç®¡ç†å‘˜ï¼ˆADMINï¼‰
**æƒé™èŒƒå›´ï¼š**
- âœ… å¯ä»¥ç®¡ç†ï¼šæ‰€æœ‰è”èµ›çš„æ‰€æœ‰å†…å®¹
- âœ… å¯ä»¥åˆ›å»º/ç®¡ç†ï¼šè”èµ›ã€çƒé˜Ÿã€çƒå‘˜ã€æ¯”èµ›

**å¯è§èœå•ï¼š**
- å¼€å§‹æ–°æ¯”èµ›
- çƒé˜Ÿç®¡ç†
- æ¯”èµ›è®°å½•
- æŠ€æœ¯ç»Ÿè®¡
- è”èµ›ç®¡ç†

## ğŸš€ ä½¿ç”¨æ­¥éª¤

### 1. å®‰è£…æ–°ä¾èµ–
```bash
cd backend
source ../venv/bin/activate
pip install python-jose[cryptography] passlib[bcrypt] email-validator pydantic-settings
```

### 2. è¿è¡Œæ•°æ®åº“è¿ç§»
```bash
cd backend
# åˆ›å»ºç”¨æˆ·å’Œè”èµ›è¡¨
python migrate_add_user_league.py

# ä¸ºç°æœ‰è¡¨æ·»åŠ league_idåˆ—
python migrate_add_league_id.py

# æ›´æ–°ç”¨æˆ·è§’è‰²ç³»ç»Ÿ
python migrate_update_user_roles.py
```

### 3. è®¾ç½®ç¯å¢ƒå˜é‡
```bash
# åœ¨ backend/.env æˆ–ç³»ç»Ÿç¯å¢ƒå˜é‡ä¸­è®¾ç½®
SECRET_KEY=your-secret-key-here-change-this-in-production
```

### 4. å¯åŠ¨åç«¯
```bash
cd backend
./start_server.sh --external  # å…è®¸å¤–ç½‘è®¿é—®
# æˆ–
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### 5. å¯åŠ¨å‰ç«¯
```bash
cd frontend
npm run dev  # ä»…æœ¬åœ°è®¿é—®
# æˆ–
npm run dev:host  # å…è®¸å¤–ç½‘è®¿é—®
```

### 6. é»˜è®¤ç®¡ç†å‘˜è´¦æˆ·
- ç”¨æˆ·åï¼š`admin`
- å¯†ç ï¼š`admin123`
- è§’è‰²ï¼šç³»ç»Ÿç®¡ç†å‘˜
- **âš ï¸ è¯·å°½å¿«ä¿®æ”¹é»˜è®¤å¯†ç ï¼**

## ğŸ“‹ æ³¨å†Œæµç¨‹

### ç”¨æˆ·æ³¨å†Œ
1. è®¿é—®ç™»å½•é¡µé¢ï¼Œç‚¹å‡»"æ³¨å†Œ"
2. å¡«å†™ç”¨æˆ·åå’Œå¯†ç 
3. **é€‰æ‹©ç”¨æˆ·è§’è‰²**ï¼š
   - çƒå‘˜ï¼šåªèƒ½æŸ¥çœ‹æ¯”èµ›è®°å½•å’ŒæŠ€æœ¯ç»Ÿè®¡
   - çƒé˜Ÿç®¡ç†å‘˜ï¼šå¯ä»¥ç®¡ç†çƒé˜Ÿå’Œçƒå‘˜
4. **é€‰æ‹©æ‰€å±è”èµ›**ï¼ˆå¿…å¡«ï¼‰
5. æ³¨å†ŒæˆåŠŸåè‡ªåŠ¨ç™»å½•

### å…¬å¼€è”èµ›åˆ—è¡¨
- æ³¨å†Œæ—¶ä½¿ç”¨ `GET /api/v1/leagues/public` æ¥å£
- ä¸éœ€è¦è®¤è¯ï¼Œæ˜¾ç¤ºæ‰€æœ‰æ¿€æ´»çš„è”èµ›
- ç”¨æˆ·å¿…é¡»é€‰æ‹©ä¸€ä¸ªè”èµ›æ‰èƒ½æ³¨å†Œ

## âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹

1. **æ•°æ®åº“è¿ç§»**ï¼š
   - è¿è¡Œè¿ç§»è„šæœ¬åï¼Œç°æœ‰æ•°æ®ä¼šè‡ªåŠ¨åˆ†é…é»˜è®¤league_id
   - å»ºè®®å…ˆå¤‡ä»½æ•°æ®åº“
   - å¦‚æœå·²æœ‰ç”¨æˆ·ï¼Œè§’è‰²ä¼šè‡ªåŠ¨æ›´æ–°

2. **é»˜è®¤ç®¡ç†å‘˜**ï¼š
   - ç”¨æˆ·åï¼šadmin
   - å¯†ç ï¼šadmin123
   - è§’è‰²ï¼šADMINï¼ˆç³»ç»Ÿç®¡ç†å‘˜ï¼‰
   - **è¯·å°½å¿«ä¿®æ”¹é»˜è®¤å¯†ç ï¼**

3. **SECRET_KEY**ï¼š
   - ç”Ÿäº§ç¯å¢ƒå¿…é¡»è®¾ç½®å¼ºå¯†é’¥
   - ä¸è¦æäº¤åˆ°Git

4. **æ•°æ®éš”ç¦»**ï¼š
   - çƒå‘˜å’Œçƒé˜Ÿç®¡ç†å‘˜åªèƒ½çœ‹åˆ°è‡ªå·±leagueçš„æ•°æ®
   - ç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥çœ‹åˆ°æ‰€æœ‰leagueçš„æ•°æ®
   - æ‰€æœ‰APIéƒ½å·²æ­£ç¡®å®ç°æƒé™è¿‡æ»¤

5. **è§’è‰²æšä¸¾å€¼**ï¼š
   - æ•°æ®åº“å­˜å‚¨çš„æ˜¯æšä¸¾çš„å­—ç¬¦ä¸²å€¼ï¼ˆPLAYER, TEAM_ADMIN, ADMINï¼‰
   - å¦‚æœé‡åˆ°è§’è‰²å€¼é”™è¯¯ï¼Œè¿è¡Œ `migrate_update_user_roles.py` æ›´æ–°

## ğŸ”§ æ•°æ®åº“æ›´æ–°ç°æœ‰æ•°æ®

å¦‚æœå·²æœ‰æ•°æ®ï¼Œè¿ç§»è„šæœ¬ä¼šè‡ªåŠ¨å¤„ç†ï¼š
- ä¸ºteamså’Œgamesè¡¨æ·»åŠ league_idåˆ—
- ä¸ºgamesè¡¨æ·»åŠ season_typeåˆ—
- ä¸ºç°æœ‰æ•°æ®åˆ†é…é»˜è®¤league_id
- æ›´æ–°ç”¨æˆ·è§’è‰²å€¼

## ğŸ“ APIä½¿ç”¨ç¤ºä¾‹

### æ³¨å†Œç”¨æˆ·ï¼ˆé€‰æ‹©è§’è‰²å’Œè”èµ›ï¼‰
```bash
curl -X POST http://localhost:8000/api/v1/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "player1",
    "password": "test123",
    "role": "player",
    "league_id": 1
  }'
```

### è·å–å…¬å¼€è”èµ›åˆ—è¡¨ï¼ˆæ³¨å†Œæ—¶ä½¿ç”¨ï¼‰
```bash
curl -X GET http://localhost:8000/api/v1/leagues/public
```

### åˆ›å»ºLeagueï¼ˆç³»ç»Ÿç®¡ç†å‘˜ï¼‰
```bash
curl -X POST http://localhost:8000/api/v1/leagues \
  -H "Authorization: Bearer ADMIN_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "2024æ˜¥å­£è”èµ›",
    "description": "æ˜¥å­£ç¯®çƒè”èµ›",
    "regular_season_name": "å¸¸è§„èµ›",
    "playoff_name": "å­£åèµ›"
  }'
```

### åˆ›å»ºæ¯”èµ›ï¼ˆå¸¦season_typeï¼‰
```bash
curl -X POST http://localhost:8000/api/v1/games \
  -H "Authorization: Bearer TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "league_id": 1,
    "home_team_id": 1,
    "away_team_id": 2,
    "date": "2024-01-15T10:00:00",
    "season_type": "regular"
  }'
```

## ğŸ¯ æƒé™æ§åˆ¶æ€»ç»“

### æŸ¥çœ‹æƒé™
- **æ‰€æœ‰ç”¨æˆ·**ï¼šå¯ä»¥æŸ¥çœ‹è‡ªå·±leagueçš„æ¯”èµ›è®°å½•å’ŒæŠ€æœ¯ç»Ÿè®¡
- **ç³»ç»Ÿç®¡ç†å‘˜**ï¼šå¯ä»¥æŸ¥çœ‹æ‰€æœ‰leagueçš„æ•°æ®

### åˆ›å»º/ä¿®æ”¹/åˆ é™¤æƒé™
- **çƒå‘˜**ï¼šâŒ æ— æƒé™
- **çƒé˜Ÿç®¡ç†å‘˜**ï¼šâœ… å¯ä»¥ç®¡ç†è‡ªå·±leagueçš„çƒé˜Ÿã€çƒå‘˜ã€æ¯”èµ›
- **ç³»ç»Ÿç®¡ç†å‘˜**ï¼šâœ… å¯ä»¥ç®¡ç†æ‰€æœ‰leagueçš„æ‰€æœ‰å†…å®¹

### è”èµ›ç®¡ç†æƒé™
- **ä»…ç³»ç»Ÿç®¡ç†å‘˜**ï¼šå¯ä»¥åˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤è”èµ›

## ğŸ”„ æ•°æ®åº“è¿ç§»è„šæœ¬

1. **migrate_add_user_league.py** - åˆ›å»ºç”¨æˆ·å’Œè”èµ›ç³»ç»Ÿ
2. **migrate_add_league_id.py** - ä¸ºç°æœ‰è¡¨æ·»åŠ league_idåˆ—
3. **migrate_update_user_roles.py** - æ›´æ–°ç”¨æˆ·è§’è‰²ç³»ç»Ÿ

æŒ‰é¡ºåºè¿è¡Œè¿™äº›è„šæœ¬å³å¯å®Œæˆæ•°æ®åº“è¿ç§»ã€‚
