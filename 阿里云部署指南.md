# 阿里云服务器部署指南

## 应用分析

### 技术栈
- **后端**：Python 3.11+ + FastAPI + SQLite
- **前端**：React 18 + TypeScript + Vite
- **数据库**：SQLite（轻量级，可升级到 PostgreSQL）
- **Web服务器**：Uvicorn (ASGI)

### 资源需求评估
- **CPU**：轻量级应用，2核足够
- **内存**：前端构建后是静态文件，后端占用较少，2GB足够，4GB更稳妥
- **存储**：应用代码 + 数据库，20GB足够，建议40GB（SSD）
- **带宽**：1-5Mbps足够（取决于并发用户数）
- **并发**：预计支持50-100个并发用户

## 服务器配置建议

### 方案一：经济型（推荐小规模使用）

**配置**：
- **实例规格**：ecs.t6-c1m2.large（2核2GB）
- **系统盘**：40GB SSD云盘
- **带宽**：1-3Mbps
- **操作系统**：Ubuntu 22.04 LTS 或 CentOS 7.9

**适用场景**：
- 小规模使用（< 20个并发用户）
- 预算有限
- 测试环境

**月费用**：约 **¥50-80/月**

### 方案二：标准型（推荐生产环境）

**配置**：
- **实例规格**：ecs.t6-c1m4.large（2核4GB）
- **系统盘**：40GB SSD云盘
- **带宽**：3-5Mbps
- **操作系统**：Ubuntu 22.04 LTS

**适用场景**：
- 中等规模使用（20-50个并发用户）
- 生产环境
- 需要更好的性能

**月费用**：约 **¥100-150/月**

### 方案三：性能型（高并发场景）

**配置**：
- **实例规格**：ecs.c6.large（2核4GB）或 ecs.c6.xlarge（4核8GB）
- **系统盘**：40GB SSD云盘
- **带宽**：5-10Mbps
- **操作系统**：Ubuntu 22.04 LTS

**适用场景**：
- 高并发（> 50个并发用户）
- 需要更好的性能
- 未来可能扩展

**月费用**：约 **¥200-400/月**

## 部署方案

### 方案A：单机部署（推荐，简单）

**架构**：
```
用户 → Nginx (80/443) → 前端静态文件 + 后端API (8000)
```

**优点**：
- 部署简单
- 成本低
- 维护方便

**缺点**：
- 前后端耦合
- 扩展性较差

### 方案B：前后端分离（推荐生产环境）

**架构**：
```
用户 → Nginx (80/443) → 前端静态文件
用户 → Nginx (80/443) → 后端API (8000)
```

**优点**：
- 前后端独立
- 易于扩展
- 更好的性能

## 详细配置建议

### 1. 服务器选择

#### 推荐配置（性价比最高）
```
实例规格：ecs.t6-c1m4.large
- CPU：2核
- 内存：4GB
- 系统盘：40GB SSD云盘
- 带宽：3Mbps
- 操作系统：Ubuntu 22.04 LTS
```

#### 最低配置（预算有限）
```
实例规格：ecs.t6-c1m2.large
- CPU：2核
- 内存：2GB
- 系统盘：20GB SSD云盘
- 带宽：1Mbps
- 操作系统：Ubuntu 22.04 LTS
```

### 2. 网络配置

**安全组规则**：
- **入站规则**：
  - HTTP (80) - 允许所有IP
  - HTTPS (443) - 允许所有IP（如果使用SSL）
  - SSH (22) - 仅允许你的IP（安全考虑）
  - 后端API (8000) - 仅允许内网或特定IP（可选）

**带宽选择**：
- 1Mbps：适合测试，约10个并发用户
- 3Mbps：适合小规模使用，约30个并发用户
- 5Mbps：适合中等规模，约50个并发用户

### 3. 存储配置

**系统盘**：
- 类型：SSD云盘（性能更好）
- 容量：40GB（足够应用 + 系统 + 日志）
- 如果数据量大，可以考虑数据盘

**数据盘**（可选）：
- 如果数据库数据量大，可以单独挂载数据盘
- 建议：20-50GB SSD云盘

## 成本估算

### 方案一：经济型
```
服务器：¥50-80/月
域名：¥50-100/年（可选）
SSL证书：免费（Let's Encrypt）
总计：约 ¥50-80/月
```

### 方案二：标准型
```
服务器：¥100-150/月
域名：¥50-100/年（可选）
SSL证书：免费（Let's Encrypt）
总计：约 ¥100-150/月
```

### 方案三：性能型
```
服务器：¥200-400/月
域名：¥50-100/年（可选）
SSL证书：免费（Let's Encrypt）
总计：约 ¥200-400/月
```

## 部署步骤（简要）

### 1. 购买服务器
- 登录阿里云控制台
- 选择ECS实例
- 选择推荐配置
- 设置安全组规则

### 2. 服务器初始化
```bash
# 更新系统
sudo apt update && sudo apt upgrade -y

# 安装必要软件
sudo apt install -y python3.11 python3-pip nodejs npm nginx git

# 配置防火墙
sudo ufw allow 22
sudo ufw allow 80
sudo ufw allow 443
sudo ufw enable
```

### 3. 部署应用
```bash
# 克隆代码
git clone <your-repo>
cd basketballStatistics

# 后端部署
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
cd backend
python init_db.py

# 前端构建
cd ../frontend
npm install
npm run build

# 配置Nginx
# ... (需要配置Nginx反向代理)
```

### 4. 配置进程管理
```bash
# 使用 systemd 或 supervisor 管理后端进程
# 配置自动启动
```

## 优化建议

### 1. 数据库优化
- 如果数据量大，考虑升级到 PostgreSQL
- 定期备份数据库
- 考虑使用阿里云RDS（如果预算允许）

### 2. 性能优化
- 使用 Nginx 作为反向代理
- 启用 Gzip 压缩
- 前端静态文件使用 CDN（可选）

### 3. 安全优化
- 使用 HTTPS（Let's Encrypt免费证书）
- 配置防火墙规则
- 定期更新系统
- 使用强密码
- 考虑使用密钥对登录

### 4. 监控和备份
- 配置云监控
- 定期备份数据库
- 配置日志收集

## 推荐配置总结

### 对于小规模使用（< 20用户）
```
ecs.t6-c1m2.large (2核2GB)
40GB SSD
1-3Mbps带宽
约 ¥50-80/月
```

### 对于中等规模使用（20-50用户）
```
ecs.t6-c1m4.large (2核4GB) ⭐ 推荐
40GB SSD
3-5Mbps带宽
约 ¥100-150/月
```

### 对于大规模使用（> 50用户）
```
ecs.c6.large (2核4GB) 或 ecs.c6.xlarge (4核8GB)
40GB SSD
5-10Mbps带宽
约 ¥200-400/月
```

## 注意事项

1. **新用户优惠**：阿里云新用户有优惠，首年可能更便宜
2. **按量付费**：如果只是测试，可以考虑按量付费
3. **地域选择**：选择离用户最近的地域，降低延迟
4. **备份策略**：定期备份数据库，避免数据丢失
5. **监控告警**：配置监控告警，及时发现问题

## 下一步

1. 购买服务器
2. 配置安全组
3. 部署应用（可以参考详细的部署文档）
4. 配置域名和SSL（可选）
5. 配置监控和备份

