# 外网访问配置说明

## 问题诊断

外网看不到数据的原因通常是：
1. 后端没有设置 `ALLOW_EXTERNAL=true`，CORS不允许外网访问
2. 前端API地址配置错误，外网设备无法连接到后端

## 解决方案

### 方案一：前后端在同一台机器（推荐）

1. **重启后端（必须设置 ALLOW_EXTERNAL=true）**：
   ```bash
   cd backend
   # 先停止当前进程
   lsof -ti :8000 | xargs kill -9
   
   # 重新启动，设置允许外网访问
   ALLOW_EXTERNAL=true uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
   ```

2. **重启前端（使用相对路径，通过Vite代理）**：
   ```bash
   cd frontend
   # 确保没有 .env 文件，或者 .env 中设置 VITE_API_URL=/api/v1
   # 启动前端，允许外网访问
   npm run dev:host
   ```

3. **访问**：
   - 同一网络其他设备：`http://你的IP:3000`
   - 你的IP可以通过 `ifconfig` 或 `ipconfig` 查看

### 方案二：前后端分离部署

1. **后端服务器**：
   ```bash
   cd backend
   ALLOW_EXTERNAL=true uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
   ```

2. **前端服务器**：
   ```bash
   cd frontend
   # 创建 .env 文件
   echo "VITE_API_URL=http://后端服务器IP:8000/api/v1" > .env
   
   # 启动前端
   npm run dev:host
   ```

## 验证步骤

1. **检查后端是否可访问**：
   ```bash
   # 在同一网络的另一台设备上
   curl http://服务器IP:8000/health
   # 应该返回：{"status":"healthy"}
   ```

2. **检查前端API连接**：
   - 打开浏览器开发者工具（F12）
   - 查看 Network 标签
   - 刷新页面，查看API请求是否成功
   - 如果看到CORS错误，说明后端没有设置 `ALLOW_EXTERNAL=true`

3. **检查数据**：
   - 访问 `http://服务器IP:3000/games`
   - 应该能看到所有比赛记录

## 常见问题

### Q: 为什么外网看不到数据？
A: 检查以下几点：
1. 后端是否设置了 `ALLOW_EXTERNAL=true`？
2. 后端是否使用 `--host 0.0.0.0`？
3. 前端是否使用 `npm run dev:host` 启动？
4. 防火墙是否允许 8000 和 3000 端口？

### Q: 数据是否同步？
A: 是的，所有数据存储在 `backend/database/basketball.db`，所有用户访问同一服务器时会看到相同的数据。

### Q: 如何查看服务器IP？
A: 
- macOS/Linux: `ifconfig | grep "inet " | grep -v 127.0.0.1`
- Windows: `ipconfig`
